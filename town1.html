<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>MAS340</title>
<script src="Scripts/jquery-3.3.1.js"></script>
<link href="Scripts/styles.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
	<script src="Scripts/jquery.js"></script>
<script src="Scripts/jquery-ui.js"></script>
<script>
$(document).ready(function(){
	QuestMemory();
	QuestCompletionMemory();
CheckTownTime('bg6','bg4');
checkInventory();
$("#noticebox").slideDown('400').delay(2200).slideUp('400');
	$('#background').addClass('bg4');
    K = {}; // keys: {37:0||1, 38:0||1, ...}
	if (localStorage.getItem("coords") != "undefined" && localStorage.getItem("coords") != null) {
		var coords = (JSON.parse("[" + localStorage.getItem("coords") + "]"));
		console.log(coords);
		if (coords[0] < 50) {
			var Pl = {el:$('#char'), x:coords[0]+65, y:coords[1], speed:coords[2]};
		} else if (coords[0] > 950) {
			var Pl = {el:$('#char'), x:coords[0]-65, y:coords[1], speed:coords[2]};
		} else {
			var Pl = {el:$('#char'), x:coords[0], y:coords[1], speed:coords[2]};
		};
	} else {
		var Pl = {el:$('#char'), x:100, y:560, speed:5};
	};	

$(document).on('keydown keyup', function(e) {
	var kN = e.which; // key Number
	if(kN>36||kN<41) K[kN]= e.type==="keydown";
	$.each($("div"),function(){
	p = $('#char').position();
	conversationCheck(p.left, p.top); // create button to start conversation
	localStorage.setItem('coords', [Pl.x,Pl.y,Pl.speed])
		$('#talkbutton').click(function() {	
			if (conversationCheck(p.left, p.top) == true) {
				$('#talkbutton').hide();
				var progress = 0;
				var dialogue;
				eventHandler();
				function eventHandler() {
					switch (progress) {
						case 0:
							$('#nextbutton, #textbox ').show();
							dialogue = "Hi, how are you doing?";
							break;
						case 1:
							dialogue = "Its a lovely evening isn't it aye"
							break;
						case 2:
							dialogue = "The person who designed this place is a genius"
							break;
						case 3:
							dialogue = "Dont you agree?"
							break;		
						case 4:
							$('#nextbutton, #textbox ').hide();			
							break;	
					}
					progress++;  
					localStorage.setItem("DialogueProgress", progress);
					$('#textbox').html(dialogue); 
				}
				$('#nextbutton').click(eventHandler);				
			}
	});
		if (p.left < 35){
			window.location = "map.html";
		} else if (p.left > 950) {
			window.location = "throne.html";
		}
	});
});

function updatePlayerPos() {
  var dist = K[38]&&(K[37]||K[39]) || K[40]&&(K[37]||K[39]) ? 0.707 : 1; 
  dist *= Pl.speed;
  if(K[37]) Pl.x -= dist;
  if(K[39]) Pl.x += dist;
  Pl.el.css({transform:"translate3D("+ Pl.x +"px, "+ Pl.y +"px, 0)"});
}

(function engine() {
  updatePlayerPos();
  window.requestAnimationFrame( engine );

}());

});

</script>

</head>
<body>
<div id="background">
<div id="noticebox"><span>Town 1<span></div>
	<div id="talkbutton"></div>
	<div id="char"></div>
	<div id="textbox"></div>
	<div id="nextbutton"></div>
</div>
</body>
</html>
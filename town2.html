<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>MAS340</title>
<script src="Scripts/jquery-3.3.1.js"></script>
<link href="Scripts/styles.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
	<script src="Scripts/jquery.js"></script>
<script src="Scripts/jquery-ui.js"></script>
<script>
$(document).ready(function(){
QuestMemory();
QuestCompletionMemory();
CheckTownTime('bg8','bg7');
checkInventory();
$("#noticebox").slideDown('400').delay(2200).slideUp('400');
	if (localStorage.getItem("coords") != "undefined" && localStorage.getItem("coords") != null) {
		var coords = (JSON.parse("[" + localStorage.getItem("coords") + "]"));
		console.log(coords);
		if (coords[0] < 35) {
			var Pl = {el:$('#char'), x:coords[0]+100, y:coords[1], speed:coords[2]};
		} else if (coords[0] > 950) {
			var Pl = {el:$('#char'), x:coords[0]-100, y:coords[1], speed:coords[2]};
		} else {
			var Pl = {el:$('#char'), x:coords[0], y:coords[1], speed:coords[2]};
		};
	} else {
		var Pl = {el:$('#char'), x:100, y:560, speed:5};
	};	
    K = {}; // keys: {37:0||1, 38:0||1, ...}
$(document).on('keydown keyup', function(e) {
  var kN = e.which; // key Number
  if(kN>36||kN<41) K[kN]= e.type==="keydown";
  $.each($("div"),function(){
    p = $('#char').position();
	conversationCheck(p.left); // create button to start conversation
	localStorage.setItem('coords', [Pl.x,Pl.y,Pl.speed]);
	$('#talkbutton').click(function() {	
		if (conversationCheck(p.left, p.top) == true) {
			$('#talkbutton').hide();
			var progress = 0;
			var dialogue;
			var character;
			eventHandler();
			function eventHandler() {
				if (p.left < 470 && p.left > 390) {
					if (localStorage.getItem('Butterfly') == 'true') {
					switch (progress) {					
						case 0:
							$('#nextbutton, #textbox ').show();
							character = 'Old Woman';
							dialogue = "Thank you so much for bringing me the Butterflies.";
							break;
						case 1:
						character = 'Old Woman';
							dialogue = "If it's not too much, I have another favour to ask"
							break;
						case 2:
						character = 'Old Woman';
							dialogue = "Could you go to the cave across the river and hand this to my son?"
							break;
						case 3:
						character = 'This guy';
							dialogue = "Sure OKAY"
							if (QuestComp[1] == false) {
								QuestToggler(1, true);
							}
							localStorage.setItem('Medicine', 'true');
							break;		
						case 4:		

						$('#nextbutton, #textbox ').hide();	
						localStorage.setItem('Butterfly', 'false');
							break;
					}					
						progress++;  
						localStorage.setItem("DialogueProgress", progress);
						$('#textbox #span2').html(dialogue);	
						$('#textbox #span1').html(character);	
				} else if (localStorage.getItem('Medicine') == 'true') {
					switch (progress) {
						case 0:
						$('#nextbutton, #textbox ').show();
							dialogue = "Please hurry";
			
							break;
						case 1:
							$('#nextbutton, #textbox ').hide();				
							break;
					}				
					progress++;  
					localStorage.setItem("DialogueProgress", progress);
						$('#textbox #span2').html(dialogue);	
						$('#textbox #span1').html(character);	
				} else {					
					switch (progress) {
						case 0:
							$('#nextbutton, #textbox ').show();
							character = 'Old Woman';
							dialogue = "Hello young man.";
							break;
						case 1:
							character = 'Old Woman';
							dialogue = "I have a favour to ask of you.";
							break;
						case 2:
							character = 'Old Woman';
							dialogue = "Could you go to forest 3 and catch me some butterflies? I need them to make medicine for my son who has fallen sick.";
							break;
						case 3:
							character = 'This guy';
							dialogue = "okey";
							if (QuestDict[1][1] == false) {
								QuestToggler('Q2', true);
								$('#QuestButton').addClass('jiggle');
							}
							break;		
						case 4:
							$('#nextbutton, #textbox ').hide();			
							break;	
					}
					progress++;  
					localStorage.setItem("DialogueProgress", progress);
											$('#textbox #span2').html(dialogue);	
						$('#textbox #span1').html(character);			
					};
				} else if (p.left < 775 && p.left > 675) {			
					switch (progress) {
						case 0:
							$('#nextbutton, #textbox ').show();
							character = 'Townsperson';
							dialogue = "Hi d00d. I'm just the random NPC just chilling here.";
							break;
						case 1:
						character = 'Townsperson';
							dialogue = "I have 39 quests for you to take.";
							break;
						case 2:
						character = 'Townsperson';
							dialogue = "jokes."
							break;
						case 3:
						character = 'This guy';
							dialogue = "Sure OKAY WHATEVS"
							break;		
						case 4:
							$('#nextbutton, #textbox ').hide();			
							break;	
					}
					progress++;  
					localStorage.setItem("DialogueProgress", progress);
											$('#textbox #span2').html(dialogue);	
						$('#textbox #span1').html(character);		
					} else if (p.left < 955 && p.left > 835) {			
					switch (progress) {
						case 0:
							$('#nextbutton, #textbox ').show();
							character = 'Guard';
							dialogue = "The King has been waiting for you, peasant from a galaxy far far away.";
							break;
						case 1:
						character = 'Guard';
							dialogue = "Draw your sword"
							break;
						case 2:
						character = 'Guard';
							dialogue = "and prepare to face the dark lord himself. loljk"
							break;
						case 3:
						character = 'This guy';
							dialogue = "Sure OKAY WHATEVS"
							break;		
						case 4:
							$('#nextbutton, #textbox ').hide();			
							break;	
					}
					progress++;  
					localStorage.setItem("DialogueProgress", progress);
						$('#textbox #span2').html(dialogue);	
						$('#textbox #span1').html(character);			
					}
			}
			$('#nextbutton').click(eventHandler);				
		}
});	
});
});

function updatePlayerPos() {
  var dist = K[38]&&(K[37]||K[39]) || K[40]&&(K[37]||K[39]) ? 0.707 : 1; 
  dist *= Pl.speed;
  if (Pl.x < 35)   {
	Pl.x = 35;
	window.location = "map.html";
  } else if ((Pl.x > 950)) {
    Pl.x = 950;
	window.location = "throne2.html";
  }
  if(K[37]) Pl.x -= dist;
  if(K[39]) Pl.x += dist;
  Pl.el.css({transform:"translate3D("+ Pl.x +"px, "+ Pl.y +"px, 0)"});
}

(function engine() {
  updatePlayerPos();
  window.requestAnimationFrame( engine );

}());

});

</script>

</head>
<body>
<div id="background">
<div id="noticebox"><span>Town 2<span></div>
	<div id="char"></div>
	<img src="images/npcs/oldwoman.png" id="old-woman">
	<img src="images/npcs/char1.png" id="char1">
	<img src="images/npcs/char4.png" id="char4">
		<div id="talkbutton"><span>Chat</span></div>
		<div id="textbox">
			<span id='span1'></span>
			<span id='span2'></span>
		</div>
		<div id="nextbutton"><span>Continue</span></div>
		<div id="inventorybutton"><a class="htmllink" href="inventory.html"><span>Inventory</span></a></div>
			<div id="QuestButton"><a class="htmllink" href="questList.html"><span>Quest List</span></a></div>
</div>
</body>
</html>